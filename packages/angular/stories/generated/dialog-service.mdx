import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Components/Dialog Service" />

# Components/Dialog Service

{/*
This file is automatically generated from dialog-service.stories.ts
Do not edit this file directly. Run 'yarn extract-templates' to regenerate.
To add custom introduction content, create dialog-service.intro.md */}

## DialogService API

The **DialogService** provides an API for programmatically opening and managing dialogs in Angular applications.

### Main Methods


#### `showModal<T, R>(config: DialogConfig<T>): DialogRef<R>`

Opens a dialog with a custom Angular component. 

**Configuration:**
- `component` (required) - The Angular component class to render.
- `data` (optional) - Data to pass to the component via `@Inject('DIALOG_DATA')`.

For general dialog configuration options like `closeButton`, `disableCancel`, etc., see the [Dialog API documentation](https://sanomalearning.design/categories/components/dialog/code/).

**Returns:** `DialogRef<R>` a reference to control the dialog and observe when it closes.

**Example:**

```typescript
// Define your dialog component
@Component({
  selector: 'app-user-dialog',
  template: `
    <h2 slot="title">User Details</h2>
    <p>User ID: {{ data.userId }}</p>
    <sl-button slot="primary-actions" (click)="dialogRef.close('saved')">Save</sl-button>
    <sl-button slot="primary-actions" (click)="dialogRef.close('cancelled')">Cancel</sl-button>
  `
})
class MyComponent {
  constructor(
    public dialogRef: DialogRef<string>,
    @Inject('DIALOG_DATA') public data: { userId: number }
  ) {}
}

// Open the dialog
const dialogRef = this.dialogService.showModal<MyComponent, string>({
  component: MyComponent,
  data: { userId: 123 },
  closeButton: true,
  disableCancel: false
});

dialogRef.afterClosed().subscribe(result => {
  console.log('Dialog closed with:', result);
});
```

---

#### `closeAll(result?: unknown): void`

Closes all currently opened dialogs at once. This could be useful when you need to close multiple dialogs simultaneously.

**Parameters:**
- `result` - Optional result value to pass to all dialogs. This value will be emitted to all `afterClosed()` subscribers.

**Example:**

```typescript
// Close all dialogs without a result
this.dialogService.closeAll();

// Close all dialogs with a specific result
this.dialogService.closeAll('cancelled');
```

---

## DialogRef API

The `DialogRef` returned by `showModal()` provides methods to control an individual dialog and observe its lifecycle.

### Methods

#### `afterClosed(): Observable<R | undefined>`

Returns an Observable that emits when the dialog closes. The Observable emits the result value passed to `close()`, or `undefined` if the dialog was dismissed without a result.

**Returns:** An Observable that completes immediately after emitting the result.

**Example:**

```typescript
dialogRef.afterClosed().subscribe(result => {
  if (result) {
    console.log('Dialog closed with result:', result);
    this.handleResult(result);
  } else {
    console.log('Dialog was dismissed');
  }
});
```

---

#### `close(result?: R): void`

Closes the dialog with an optional result value. The result will be emitted to all `afterClosed()` subscribers.

**Parameters:**
- `result` - Optional result value to pass to subscribers

**Example:**

```typescript
// In the dialog component:
@Component({ /* ... */ })
export class MyDialogComponent {
  constructor(public dialogRef: DialogRef<string>) {}
  
  save() {
    this.dialogRef.close('saved');
  }
  
  cancel() {
    this.dialogRef.close('cancelled');
  }
}
```

---

## Injecting Data into Dialog Components

Dialog components can receive data through dependency injection using the `'DIALOG_DATA'` token.

### Basic Data Injection

```typescript
import { Component, Inject } from '@angular/core';
import { DialogRef } from '@sl-design-system/angular';

@Component({
  template: `
    <h2 slot="title">{{ data.title }}</h2>
    <p>{{ data.message }}</p>
    <sl-button (click)="dialogRef.close('ok')" slot="primary-actions">OK</sl-button>
  `
})
export class MyDialogComponent {
  constructor(
    public dialogRef: DialogRef<string>,
    @Inject('DIALOG_DATA') public data: { title: string; message: string }
  ) {}
}
```

### Opening the Dialog with Data

```typescript
this.dialogService.showModal<MyDialogComponent, string>({
  component: MyDialogComponent,
  data: {
    title: 'Confirmation',
    message: 'Are you sure you want to continue?'
  }
});
```

---

## Configuration Options

### DialogConfig

```typescript
interface DialogConfig<T> extends Partial<DialogProps> {
  /** Angular component to render in the dialog */
  component: Type<T>;
  
  /** Data to pass to the component via @Inject('DIALOG_DATA') */
  data?: unknown;
}
```

The `DialogConfig` extends `Partial<DialogProps>`, which includes all public properties from the Dialog component such as `closeButton`, `disableCancel` etc. Please check the [Dialog API documentation](https://sanomalearning.design/categories/components/dialog/code/) for all available configuration options.

---

## Dialog Service Example

<p>The <strong>DialogService</strong> provides a way to programmatically open and manage dialogs in Angular applications.</p>


```typescript
import { DialogRef, DialogService } from '@sl-design-system/angular';
import { ButtonComponent } from '@sl-design-system/angular/button';
import { DialogComponent } from '@sl-design-system/angular/dialog';
import { FormComponent, FormFieldComponent } from '@sl-design-system/angular/form';
import { TextAreaDirective, TextFieldDirective } from '@sl-design-system/angular/forms';
import { TextAreaComponent } from '@sl-design-system/angular/text-area';
import { TextFieldComponent } from '@sl-design-system/angular/text-field';

@Component({
  selector: 'sla-dialog-service',
  template: `
  <h3>Dialog Service examples</h3>
  <div style="display: flex; gap: 0.8rem; flex-wrap: wrap;">
    <sl-button (click)="openBasicDialog()">Open dialog</sl-button>
    <sl-button (click)="openNonCancellableDialog()">Open dialog without close button</sl-button>
  </div>
`,
  imports: [ButtonComponent, CommonModule]
})
export class DialogServiceExampleComponent {

  lastResult: string | undefined;

  constructor(private dialogService: DialogService) {}

  openBasicDialog(): void {
    const dialogRef = this.dialogService.showModal<ExampleDialogComponent, string>({
      component: ExampleDialogComponent,
      data: {
        title: 'Dialog title',
        message: 'This is a dialog with close button.'
      },
      closeButton: true
    });

    dialogRef.afterClosed().subscribe((result: string | undefined) => {
      this.lastResult = result;
      console.log('Dialog closed with result:', result);
    });
  }

  openNonCancellableDialog(): void {
    const dialogRef = this.dialogService.showModal<ExampleDialogComponent, string>({
      component: ExampleDialogComponent,
      data: {
        title: 'Non-cancellable dialog title',
        message: 'This dialog cannot be closed by clicking the backdrop or pressing Escape.'
      },
      disableCancel: true,
      closeButton: false
    });

    dialogRef.afterClosed().subscribe(result => {
      this.lastResult = result;
      console.log('Dialog closed with result:', result);
    });
  }

}
```

**Referenced Components:**

The examples above use the following custom component(s):


```typescript
@Component({
  standalone: true,
  imports: [ButtonComponent, CommonModule],
  template: `
  <style>
    h2 {
      font-size: inherit;
      font-weight: inherit;
      margin: 0;
    }
  </style>
  <h2 slot="title">{{ data.title }}</h2>
  <p>{{ data.message }}</p>
  <div>Example content.</div>
  <sl-button (click)="dialogRef.close('cancelled')" slot="primary-actions">Cancel</sl-button>
  <sl-button (click)="dialogRef.close('confirmed')" slot="primary-actions" variant="primary">Confirm</sl-button>
`
})
export class ExampleDialogComponent {

  constructor(
    public dialogRef: DialogRef<string>,
    @Inject('DIALOG_DATA') public data: { title: string; message: string }
  ) {}

}
```

## Form In Dialog Example

<p>This example demonstrates how to use a form inside a dialog opened with the DialogService.</p>


```typescript
import { DialogRef, DialogService } from '@sl-design-system/angular';
import { ButtonComponent } from '@sl-design-system/angular/button';
import { DialogComponent } from '@sl-design-system/angular/dialog';
import { FormComponent, FormFieldComponent } from '@sl-design-system/angular/form';
import { TextAreaDirective, TextFieldDirective } from '@sl-design-system/angular/forms';
import { TextAreaComponent } from '@sl-design-system/angular/text-area';
import { TextFieldComponent } from '@sl-design-system/angular/text-field';

@Component({
  selector: 'sla-dialog-form',
  template: `
  <style>
    h2 {
      font-size: inherit;
      font-weight: inherit;
      margin: 0;
    }
  </style>
  <h2 slot="title">{{ data.title }}</h2>
  <span>{{ data.details }}</span>
  <sl-form #form>
    <sl-form-field label="Text field">
      <sl-text-field [(ngModel)]="formGroup.textField" required></sl-text-field>
    </sl-form-field>
    <sl-form-field label="Text area">
      <sl-text-area [(ngModel)]="formGroup.textArea"></sl-text-area>
    </sl-form-field>
  </sl-form>
  <sl-button slot="primary-actions" (click)="dialogRef.close()">Cancel</sl-button>
  <sl-button slot="primary-actions" variant="primary" (click)="submitForm()">Save</sl-button>
`,
  imports: [
    ButtonComponent,
    CommonModule,
    FormComponent,
    FormFieldComponent,
    FormsModule,
    ReactiveFormsModule,
    TextAreaComponent,
    TextAreaDirective,
    TextFieldComponent,
    TextFieldDirective
]
})
export class DialogFormComponent {

  constructor(
    public dialogRef: DialogRef,
    @Inject('DIALOG_DATA') public data: { title: string; details: string }
  ) {}

  @ViewChild('form') form!: FormComponent;

  formGroup = new FormGroup({
    textField: new FormControl(''),
    textArea: new FormControl('')
  });

  submitForm() {
    if (!this.form.el.valid) {
      this.form.el.reportValidity();
    } else {
      this.dialogRef.close(this.formGroup);
    }
  }
}

interface DialogFormResult {
  textField: string;
  textArea: string;

}
```

