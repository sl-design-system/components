import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Components/Message Dialog Service" />

# Components/Message Dialog Service

{/*
This file is automatically generated from message-dialog-service.stories.ts
Do not edit this file directly. Run 'yarn extract-templates' to regenerate.
To add custom introduction content, create message-dialog-service.intro.md */}

## MessageDialogService API

The **MessageDialogService** provides an API for displaying and managing message dialogs in Angular applications.

### Main Methods

#### `showModal<T, R>(config: MessageDialogServiceConfig<T, R>): MessageDialogRef<R>`

Opens a message dialog with a custom Angular component or simple message content. This is the primary method for showing message dialogs.

**Parameters:**
- `config.component` - Optional Angular component to render as the message content
- `config.data` - Optional data to pass to the component (available via `MESSAGE_DIALOG_DATA` injection token)
- `config.title` - The title of the message dialog
- `config.message` - The message to display (for non-component dialogs)
- `config.buttons` - Array of button configurations with text, variant, and value
- `config.disableCancel` - If true, prevents closing via Escape key or backdrop click

**Returns:** A `MessageDialogRef` instance for controlling the dialog and observing when it closes.

**Examples:**

With custom component:
```typescript
const dialogRef = this.messageDialogService.showModal<MyComponent, string>({
  component: MyComponent,
  data: { name: 'John', age: 30 },
  title: 'User Details',
  buttons: [
    { text: 'Close', value: 'close' },
    { text: 'Save', variant: 'primary', value: 'save' }
  ]
});

dialogRef.afterClosed().subscribe(result => {
  console.log('Dialog closed with:', result);
});
```

With simple message:
```typescript
const dialogRef = this.messageDialogService.showModal({
  title: 'Warning',
  message: 'This action cannot be undone.',
  buttons: [
    { text: 'Cancel', value: 'cancel' },
    { text: 'Continue', variant: 'warning', value: 'continue' }
  ],
  disableCancel: false
});
```

---

#### `alert(message: string, title?: string): Promise<void>`

Shows a simple alert message to the user with an OK button.

**Note:** This method uses the static MessageDialog API and does not return a `MessageDialogRef`.

**Example:**
```typescript
await this.messageDialogService.alert('Operation completed successfully!', 'Success');
```

---

#### `confirm(message: string, title?: string): Promise<boolean | undefined>`

Shows a confirmation dialog with OK and Cancel buttons. Returns `true` if OK is clicked, `false` if Cancel is clicked, or `undefined` if dismissed.

**Note:** This method uses the static MessageDialog API and does not return a `MessageDialogRef`.

**Example:**
```typescript
const confirmed = await this.messageDialogService.confirm(
  'Are you sure you want to delete this item?',
  'Confirm Deletion'
);
if (confirmed) {
  // User clicked OK
  this.deleteItem();
}
```

---

#### `show<T>(config: MessageDialogConfig<T>): Promise<T | undefined>`

Shows a message dialog with custom configuration using the static MessageDialog API.

**Note:** This method uses the static MessageDialog API and does not return a `MessageDialogRef`.

**Example:**
```typescript
const result = await this.messageDialogService.show({
  title: 'Choose an option',
  message: 'Please select how you want to proceed.',
  buttons: [
    { text: 'Cancel', value: 'cancel' },
    { text: 'Save Draft', variant: 'default', value: 'draft' },
    { text: 'Publish', variant: 'primary', value: 'publish' }
  ]
});

if (result === 'publish') {
  this.publishContent();
}
```

---

#### `closeAll(result?: unknown): void`

Closes all currently opened message dialogs. This method is useful when you need to close multiple message dialogs at once, for example when navigating away from a page or when a critical error occurs.

**Parameters:**
- `result` - Optional result to pass to all dialogs. This value will be emitted to all `afterClosed()` subscribers.

**Example:**
```typescript
// Close all dialogs without passing a result
this.messageDialogService.closeAll();

// Close all dialogs with a specific result
this.messageDialogService.closeAll('cancelled');
```

---

## MessageDialogRef API

The `MessageDialogRef` class provides methods to control the dialog lifecycle and observe when it closes.

### Methods

#### `afterClosed(): Observable<T | undefined>`

Returns an Observable that emits when the dialog closes. The Observable will emit the result value passed to `close()`, or `undefined` if the dialog was dismissed without a result.

**Example:**
```typescript
dialogRef.afterClosed().subscribe(result => {
  if (result) {
    console.log('Dialog closed with result:', result);
  } else {
    console.log('Dialog was dismissed');
  }
});
```

---

#### `close(result?: T): void`

Closes the dialog with an optional result value. The result value will be emitted to all subscribers of `afterClosed()`.

**Example:**
```typescript
// Close with a specific result
dialogRef.close('save');

// Close without a result
dialogRef.close();
```

---

## Injecting MessageDialogRef into Components

Components rendered inside the dialog can inject `MessageDialogRef` to close themselves:

```typescript
import { Component } from '@angular/core';
import { MessageDialogRef } from '@sl-design-system/angular';

@Component({
  template: `
    <button (click)="save()">Save</button>
    <button (click)="cancel()">Cancel</button>
  `
})
export class MyDialogComponent {
  constructor(private dialogRef: MessageDialogRef<string>) {}

  save() {
    this.dialogRef.close('save');
  }

  cancel() {
    this.dialogRef.close('cancel');
  }
}
```

---

## Configuration Options

### MessageDialogServiceConfig

Configuration interface for opening a message dialog with the MessageDialogService.

#### For Component-based Dialogs:
```typescript
{
  component: MyComponent,      // Angular component to render
  data: { userId: 123 },       // Data to pass to the component
  title: 'Edit User',          // Dialog title
  buttons: [                   // Custom buttons
    { text: 'Cancel', value: 'cancel' },
    { text: 'Save', variant: 'primary', value: 'save' }
  ],
  disableCancel: false         // Allow Escape key and backdrop clicks
}
```

#### For Message-based Dialogs:
```typescript
{
  title: 'Warning',            // Dialog title
  message: 'Are you sure?',    // Message text
  buttons: [                   // Custom buttons
    { text: 'No', value: 'no' },
    { text: 'Yes', variant: 'primary', value: 'yes' }
  ],
  disableCancel: true          // Prevent Escape key and backdrop clicks
}
```

---

## Message Dialog Service Example

<p>The <strong>MessageDialogService</strong> provides a comprehensive API for displaying message dialogs in Angular applications.</p>


```typescript
import { MessageDialogService } from '@sl-design-system/angular';
import { ButtonComponent } from '@sl-design-system/angular/button';
import { MessageDialog as MessageDialogElement } from '@sl-design-system/message-dialog';

@Component({
  selector: 'sla-message-dialog-service',
  template: `<style>
    .container {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
      flex-direction: column;
      max-width: 700px;
    }
  </style>
  <h3>Message Dialog Service examples</h3>
  <div class="container">
    <div>
      <h4>Static methods (recommended for simple cases)</h4>
      <p>These methods use the MessageDialog static API and work well for simple alerts and confirmations:</p>
      <div style="display: flex; gap: 0.8rem; flex-wrap: wrap;">
        <sl-button (click)="showAlert()" variant="primary">Show Alert</sl-button>
        <sl-button (click)="showAlertNonCancellable()" variant="primary" fill="outline"
          >Alert (Non-cancellable)</sl-button
        >
        <sl-button (click)="showConfirm()" variant="secondary">Show Confirm</sl-button>
        <sl-button (click)="showCustomButtons()" variant="info">Custom Buttons</sl-button>
      </div>
    </div>

    <div>
      <h4>With Custom Angular Component</h4>
      <p>
        Use <code>showModal()</code> to render a custom Angular component as the message content. This is useful for
        complex dialogs with forms or interactive content:
      </p>
      <div style="display: flex; gap: 0.8rem; flex-wrap: wrap;">
        <sl-button (click)="showWithComponent()" variant="primary">Show with Component</sl-button>
        <sl-button (click)="showCriticalAction()" variant="danger">Critical Action</sl-button>
      </div>
    </div>
  </div>`,
  imports: [ButtonComponent, CommonModule]
})
export class MessageDialogServiceExampleComponent {

  lastResult: string | undefined;

  constructor(private messageDialogService: MessageDialogService) {}

  async showAlert(): Promise<void> {
    await this.messageDialogService.alert(
      'This is an alert message. Use this to alert the user about something. This is the design system equivalent of calling window.alert().',
      'Alert'
    );
    this.lastResult = 'Alert closed';
    console.log('Alert was closed');
  }

  async showAlertNonCancellable(): Promise<void> {
    await this.messageDialogService.show({
      title: 'Important Notice',
      message: 'This is a critical alert that cannot be cancelled. You must acknowledge it by clicking OK.',
      buttons: [{ text: 'OK', variant: 'primary', autofocus: true }],
      disableCancel: true
    });
    this.lastResult = 'Non-cancellable alert closed';
    console.log('Non-cancellable alert was closed');
  }

  async showConfirm(): Promise<void> {
    const result = await this.messageDialogService.confirm(
      'This is a confirmation message. The message dialog contains a "Cancel" and "OK" button by default. You can customize this using the buttons property.',
      'Confirm'
    );

    if (result !== undefined) {
      await this.messageDialogService.alert(`The result was: ${result}`);
    }

    this.lastResult = `Confirm: ${result === true ? 'OK' : result === false ? 'Cancel' : 'Closed'}`;

    console.log('Confirmation result:', result);
  }

  async showCustomButtons(): Promise<void> {
    const result = await this.messageDialogService.show({
      title: 'Custom buttons',
      message: 'This is a message with custom buttons. Are you sure you want to press any buttons?',
      buttons: [
        { text: 'No, run away!', fill: 'outline', value: 'NO', variant: 'primary' },
        { text: "Yes, I don't care what it does", value: 'YES', variant: 'danger' }
      ],
      disableCancel: true
    });
    this.lastResult = `Custom: ${result ?? 'Cancelled'}`;
    console.log('User selected:', result);
  }

  showWithComponent(): void {
    const dialogRef = this.messageDialogService.showModal<CustomMessageComponent, string>({
      component: CustomMessageComponent,
      data: 'This is some data passed to the component!',
      title: 'Custom Component Message',
      buttons: [
        { text: 'Cancel', fill: 'ghost', value: 'cancel' },
        { text: 'OK', variant: 'primary', autofocus: true, value: 'ok' }
      ]
    });

    dialogRef.afterClosed().subscribe(result => {
      this.lastResult = `Component dialog: ${result ?? 'Cancelled'}`;
      console.log('Component dialog closed with result:', result);
    });
  }

  showCriticalAction(): void {
    const dialogRef = this.messageDialogService.showModal<CustomMessageComponent, string>({
      component: CustomMessageComponent,
      data: 'You are about to perform a critical action that requires confirmation.',
      title: 'Critical Action Required',
      buttons: [{ text: 'I Understand, Proceed', variant: 'danger', autofocus: true, value: 'proceed' }],
      disableCancel: true
    });

    dialogRef.afterClosed().subscribe(result => {
      this.lastResult = `Critical action: ${result ?? 'Should not happen'}`;
      console.log('Critical action dialog closed with result:', result);
    });
  }

}
```

## Advanced Example

<p>Advanced examples demonstrating powerful features of the MessageDialogService:</p>


```typescript
import { MessageDialogService } from '@sl-design-system/angular';
import { ButtonComponent } from '@sl-design-system/angular/button';
import { MessageDialog as MessageDialogElement } from '@sl-design-system/message-dialog';

@Component({
  selector: 'sla-message-dialog-advanced',
  template: `<h3>Advanced Message Dialog Service examples</h3>
  <p>Demonstrates programmatic control, multiple dialogs, and complex scenarios.</p>
  <div style="display: flex; gap: 0.8rem; flex-wrap: wrap; flex-direction: column; max-width: 700px;">
    <div>
      <h4>Multiple Dialogs</h4>
      <p>Open and manage multiple dialogs simultaneously:</p>
      <div style="display: flex; gap: 0.8rem; flex-wrap: wrap;">
        <sl-button (click)="openMultipleDialogs()" variant="primary">Open Multiple Dialogs</sl-button>
        <sl-button (click)="closeAll()" variant="danger">Close All Dialogs</sl-button>
      </div>
    </div>

    <div>
      <h4>Sequential Dialogs</h4>
      <p>Show dialogs one after another based on user actions:</p>
      <div style="display: flex; gap: 0.8rem; flex-wrap: wrap;">
        <sl-button (click)="showSequentialDialogs()" variant="info">Start Wizard</sl-button>
      </div>
    </div>

    <div>
      <h4>Programmatic Control</h4>
      <p>Control dialogs programmatically with timeouts or conditions:</p>
      <div style="display: flex; gap: 0.8rem; flex-wrap: wrap;">
        <sl-button (click)="showAutoClosingDialog()" variant="warning">Auto-closing Dialog</sl-button>
      </div>
    </div>
  </div>`,
  imports: [ButtonComponent, CommonModule]
})
export class MessageDialogAdvancedExampleComponent {

  status = 'Ready';

  constructor(private messageDialogService: MessageDialogService) {}

  openMultipleDialogs(): void {
    this.status = 'Opening multiple dialogs...';

    // Open first dialog
    const dialog1 = this.messageDialogService.showModal({
      title: 'First Dialog',
      message: 'This is the first dialog. You can open multiple dialogs at once.',
      buttons: [{ text: 'OK', variant: 'primary', value: 'ok1' }]
    });

    dialog1.afterClosed().subscribe(result => {
      console.log('First dialog result:', result);
      this.status = `First dialog closed with: ${result}`;
    });

    // Open second dialog after a short delay
    setTimeout(() => {
      const dialog2 = this.messageDialogService.showModal({
        title: 'Second Dialog',
        message: 'This is the second dialog. Both dialogs are open simultaneously.',
        buttons: [{ text: 'OK', variant: 'info', value: 'ok2' }]
      });

      dialog2.afterClosed().subscribe(result => {
        console.log('Second dialog result:', result);
        this.status = `Second dialog closed with: ${result}`;
      });
    }, 500);
  }

  closeAll(): void {
    this.messageDialogService.closeAll();
    this.status = 'All dialogs closed programmatically';
    console.log('All dialogs closed');
  }

  async showSequentialDialogs(): Promise<void> {
    this.status = 'Starting wizard...';

    // Step 1
    const step1 = await this.messageDialogService.show({
      title: 'Step 1: Welcome',
      message: 'Welcome to the setup wizard. Click Next to continue.',
      buttons: [
        { text: 'Cancel', value: 'cancel', fill: 'ghost' },
        { text: 'Next', value: 'next', variant: 'primary', autofocus: true }
      ]
    });

    if (step1 !== 'next') {
      this.status = 'Wizard cancelled at Step 1';
      return;
    }

    // Step 2
    const step2 = await this.messageDialogService.show({
      title: 'Step 2: Configuration',
      message: 'Please confirm your configuration settings.',
      buttons: [
        { text: 'Back', value: 'back', fill: 'ghost' },
        { text: 'Next', value: 'next', variant: 'primary', autofocus: true }
      ]
    });

    if (step2 !== 'next') {
      this.status = 'Wizard cancelled at Step 2';
      return;
    }

    // Step 3 - Final confirmation
    await this.messageDialogService.show({
      title: 'Step 3: Confirmation',
      message: 'Setup complete! Your changes have been saved.',
      buttons: [{ text: 'Finish', value: 'finish', variant: 'success', autofocus: true }],
      disableCancel: true
    });

    this.status = 'Wizard completed successfully!';
  }

  showAutoClosingDialog(): void {
    this.status = 'Opening auto-closing dialog...';

    const dialogRef = this.messageDialogService.showModal({
      title: 'Auto-closing Dialog',
      message: 'This dialog will automatically close in 5 seconds unless you click OK first.',
      buttons: [{ text: 'OK', variant: 'primary', value: 'ok' }]
    });

    // Auto-close after 5 seconds
    const timeout = setTimeout(() => {
      dialogRef.close('timeout');
      this.status = 'Dialog auto-closed after timeout';
    }, 5000);

    dialogRef.afterClosed().subscribe(result => {
      clearTimeout(timeout);
      if (result === 'timeout') {
        console.log('Dialog was auto-closed');
      } else {
        this.status = `Dialog closed by user: ${result}`;
        console.log('Dialog closed by user:', result);
      }
    });
  }

}
```

## Custom Message

<p>Example showing how to use HTML content in message dialogs using the static <code>MessageDialog.show()</code> method with Lit HTML. <br /> For Angular components, use the <code>showModal()</code> method with a custom component instead (see the main example).</p>


```typescript
import { MessageDialogService } from '@sl-design-system/angular';
import { ButtonComponent } from '@sl-design-system/angular/button';
import { MessageDialog as MessageDialogElement } from '@sl-design-system/message-dialog';

@Component({
  selector: 'sla-message-dialog-custom-message',
  template: `<div style="padding: 1rem;">
    <p>Example showing how to use HTML content with the static MessageDialog API.</p>
    <sl-button (click)="showCustomMessage()" variant="primary">Show Custom HTML Message</sl-button>
  </div>`,
  imports: [ButtonComponent]
})
export class MessageDialogCustomMessageExampleComponent {

  async showCustomMessage(): Promise<void> {
    const { html } = await import('lit');
    await MessageDialogElement.show({
      title: 'Custom message',
      message: html`You can <em>customize</em> the message with <strong>HTML</strong>!`,
      buttons: [{ text: 'OK', variant: 'primary' }],
      disableCancel: true
    });
  }

}
```

