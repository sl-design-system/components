$md-breakpoint: 600px;

:host {
  --_background: var(--sl-color-dialog-background);
  --_border: var(--sl-border-width-dialog-default) solid var(--sl-color-dialog-border);
  --_border-radius-mobile: var(--sl-border-radius-dialog-mobile);
  --_border-radius-desktop: var(--sl-border-radius-dialog-desktop);
  --_border-radius: var(--_border-radius-mobile);
  --_header-gap: var(--sl-space-dialog-gap-header);
  --_heading-direction: var(--sl-dialog-header-flex-direction);
  --_heading-gap: var(--sl-space-dialog-gap-header);
  --_body-gap-mobile: var(--sl-space-dialog-mobile-body-gap);
  --_body-gap-desktop: var(--sl-space-dialog-desktop-body-gap);
  --_body-gap: var(--_body-gap-mobile);
  --_footer-direction-mobile: column-reverse;
  --_footer-direction-desktop: var(--sl-dialog-footer-flex-direction);
  --_footer-direction: var(--_footer-direction-mobile);
  --_footer-align: var(--sl-dialog-footer-justify-content);
  --_max-inline-size-mobile: var(--sl-size-dialog-full);
  --_min-inline-size: var(--sl-size-dialog-min);
  --_max-inline-size-desktop: var(--sl-size-dialog-max);
  --_max-inline-size: var(--_max-inline-size-mobile);
  --_padding-block-mobile: var(--sl-space-dialog-mobile-body-block);
  --_padding-inline-mobile: var(--sl-space-dialog-mobile-body-inline);
  --_padding-block-desktop: var(--sl-space-dialog-desktop-body-block);
  --_padding-inline-desktop: var(--sl-space-dialog-desktop-body-inline);
  --_padding-block: var(--_padding-block-mobile);
  --_padding-inline: var(--_padding-inline-mobile);
  --_margin-container-inline-desktop: var(--sl-space-dialog-desktop-container-inline);
  --_margin-top-container-desktop: var(--sl-space-dialog-desktop-container-padding-top);
  --_margin-bottom-container-desktop: var(--sl-space-dialog-desktop-container-padding-bottom);
  --_margin-container-inline-mobile: var(--sl-space-dialog-mobile-container-inline);
  --_margin-top-container-mobile: var(--sl-space-dialog-mobile-container-padding-top);
  --_margin-bottom-container-mobile: var(--sl-space-dialog-mobile-container-padding-bottom);
  --_margin-container-inline: var(--_margin-container-inline-mobile);
  --_margin-top-container: var(--_margin-top-container-mobile);
  --_margin-bottom-container: var(--_margin-bottom-container-mobile);
  --_color: var(--sl-color-dialog-foreground);
  --_subtitle-font: var(--sl-text-dialog-subheading);
  --_subtitle-padding-bottom: var(--sl-space-dialog-subtitle-padding-bottom);
  --_title-font: var(--sl-text-dialog-heading);
  --_body-font: var(--sl-text-body-lg-normal);
}

:host {
  display: block;
  text-align: inherit;
}

dialog {
  background: var(--_background);
  border: var(--_border);
  border-radius: var(--_border-radius);
  color: var(--_color);
  display: flex;
  flex-direction: column;
  inset: 0;
  margin: auto auto 0;
  max-block-size: min(
    100%,
    100vh - var(--_margin-top-container) - var(--_margin-bottom-container) - 2 * var(--_padding-block)
  );
  max-inline-size: var(--_max-inline-size);
  opacity: 0;
  overflow: hidden;
  padding-block: var(--_padding-block);
  padding-inline: var(--_padding-inline);
  position: fixed;
  width: auto;

  &::backdrop {
    --backdrop-background: var(
      --sl-color-select-item-active-foreground
    ); // TODO: should come from the token --sl-body-surface-overlay
    opacity: 0;
    transition: all 0.5s;
  }
}

dialog[open] {
  opacity: 1;

  &::backdrop {
    opacity: 1;
  }
}

slot[name='header'] {
  display: flex;
  justify-content: space-between;
  margin-bottom: var(--_header-gap);
}

.titles {
  align-items: flex-start;
  display: flex;
  flex-direction: var(--_heading-direction);
  gap: var(--_heading-gap);
}

slot[name='header-actions'] {
  display: inline-flex;
}

slot[name='header-buttons'],
slot[name='header-buttons']::slotted(*) {
  display: flex;
}

slot[name='close-button'] {
  display: block;
}

slot[name='close-button']::slotted(*),
slot[name='header-buttons']::slotted(*) {
  align-self: baseline;
}

slot[name='subtitle']::slotted(*) {
  font: var(--_subtitle-font);
  padding-bottom: var(--_subtitle-padding-bottom);
}

slot[name='title']::slotted(*) {
  font: var(--_title-font);
}

.body-content {
  font: var(--_body-font);
  margin: var(--_body-gap) 0;
  overflow: auto;
}

slot[name='footer'] {
  sl-button-bar {
    align-items: stretch;
    flex-direction: var(--_footer-direction);
    flex-grow: 1;
    flex-shrink: 0;
  }
}

@media screen and (min-width: $md-breakpoint) {
  :host {
    --_border-radius: var(--_border-radius-desktop);
    --_padding-block: var(--_padding-block-desktop);
    --_padding-inline: var(--_padding-inline-desktop);
    --_margin-bottom-container: var(--_margin-bottom-container-desktop);
    --_margin-top-container: var(--_margin-top-container-desktop);
    --_max-inline-size: var(--_max-inline-size-desktop);
    --_margin-container-inline: var(--_margin-container-inline-desktop);
    --_body-gap: var(--_body-gap-desktop);
    --_footer-direction: var(--_footer-direction-desktop);
  }

  dialog {
    margin: auto;
    max-block-size: min(
      100% - var(--_margin-top-container) - var(--_margin-bottom-container) - 2 * var(--_padding-block)
    );
    max-inline-size: min(
      var(--_max-inline-size),
      100% - 2 * var(--_margin-container-inline) - 2 * var(--_padding-inline)
    );
    min-inline-size: var(--_min-inline-size);
    width: fit-content;
  }

  slot[name='footer'] {
    sl-button-bar {
      align-items: center;
      justify-content: var(--_footer-align);
    }
  }
}

@media (prefers-reduced-motion: no-preference) {
  dialog[closing] {
    animation: slide-down 400ms ease-out;

    &::backdrop {
      animation: backdrop-hide 400ms ease-out;
    }
  }

  dialog[open]:not([closing]) {
    animation: slide-in-up 600ms ease-out;

    &::backdrop {
      animation: backdrop-show 600ms ease-out;
    }
  }
}

@keyframes slide-in-up {
  0% {
    opacity: 0;
    transform: translateY(80px);
  }

  50% {
    opacity: 0.75;
  }

  80% {
    transform: translateY(-20px);
  }

  90% {
    opacity: 1;
    transform: translateY(-10px);
  }

  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slide-down {
  0% {
    opacity: 1;
    transform: translateY(0);
  }

  50% {
    opacity: 0.5;
    transform: translateY(80px);
  }

  100% {
    opacity: 0;
    transform: translateY(80px);
  }
}

@keyframes backdrop-show {
  0% {
    opacity: 0;
  }

  50% {
    opacity: 0.75;
  }

  100% {
    opacity: 1;
  }
}

@keyframes backdrop-hide {
  from {
    opacity: 1;
  }

  to {
    opacity: 0;
  }
}
